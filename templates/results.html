<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Resultados ‚Äî Otimiza√ß√£o Agr√≠cola</title>
    <link rel="stylesheet" href="/static/style.css">
  </head>
  <body>
    <div class="container">
      <h1>üìä Resultados da An√°lise de Otimiza√ß√£o</h1>

      <!-- Par√¢metros de Entrada -->
      <div class="section">
        <h2>üîß Par√¢metros Utilizados</h2>
        <p><strong>√Årea Dispon√≠vel:</strong> {{ A }} hectares</p>
        <p><strong>Theta (Œ∏):</strong> {{ theta }} (coeficiente de rendimentos decrescentes)</p>
        <p><strong>Modelo:</strong> L(x) = ax - bx¬≤ onde b = Œ∏ √ó a</p>
      </div>

      <!-- Recomenda√ß√£o Principal -->
      <div class="highlight-box">
        <h2>üèÜ RECOMENDA√á√ÉO: Melhor Cultura para {{ A }} hectares</h2>
        <p class="best-culture">{{ best }}</p>
        <p class="best-profit">Lucro Estimado: R$ {{ "%.2f"|format(best_profit) }}</p>
      </div>

      <!-- An√°lise Matem√°tica Completa -->
      <div class="section">
        <h2>üìê An√°lise Matem√°tica (Derivadas)</h2>
        
        <table>
          <thead>
            <tr>
              <th>Cultura</th>
              <th>Ponto √ìtimo<br>(x*)</th>
              <th>Lucro √ìtimo<br>(L(x*))</th>
              <th>L''(x*)</th>
              <th>Classifica√ß√£o</th>
              <th>Lucro em A={{ A }}ha</th>
            </tr>
          </thead>
          <tbody>
            {% for culture in optimization_results %}
            <tr class="{% if culture == best %}highlight{% endif %}">
              <td><strong>{{ culture }}</strong></td>
              <td>{{ "%.2f"|format(optimization_results[culture]['x_otimo']) }} ha</td>
              <td>R$ {{ "%.2f"|format(optimization_results[culture]['lucro_otimo']) }}</td>
              <td>{{ "%.4f"|format(optimization_results[culture]['segunda_derivada']) }}</td>
              <td>
                {% if optimization_results[culture]['segunda_derivada'] < 0 %}
                <span style="color: green;">‚úì M√ÅXIMO</span>
                {% else %}
                <span style="color: red;">‚úó M√çNIMO</span>
                {% endif %}
              </td>
              <td>R$ {{ "%.2f"|format(profits[culture]) }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <div class="math-explanation">
          <h3>üî¨ Como Chegamos Neste Resultado:</h3>
          <p><strong>1. Fun√ß√£o Objetivo:</strong> L(x) = ax - bx¬≤</p>
          <p><strong>2. Primeira Derivada:</strong> L'(x) = a - 2bx</p>
          <p><strong>3. Ponto Cr√≠tico (L'(x) = 0):</strong> x* = a/(2b)</p>
          <p><strong>4. Segunda Derivada:</strong> L''(x) = -2b &lt; 0 ‚üπ <strong>M√ÅXIMO</strong></p>
          <p><strong>5. Conclus√£o:</strong> Para cada cultura, calculamos x* (√°rea √≥tima) e L(x*) (lucro m√°ximo poss√≠vel)</p>
        </div>
      </div>

      <!-- Compara√ß√£o Visual -->
      <div class="section">
        <h2>üìä Compara√ß√£o de Lucros em A = {{ A }} ha</h2>
        <img src="/{{ plot_path }}" alt="Gr√°fico Comparativo" style="max-width: 100%; height: auto;">
      </div>

      <!-- Gr√°fico de Otimiza√ß√£o -->
      <div class="section">
        <h2>üìà An√°lise de Otimiza√ß√£o - {{ best }}</h2>
        <p>O gr√°fico abaixo mostra a fun√ß√£o lucro L(x) para <strong>{{ best }}</strong>, 
        destacando o ponto √≥timo x* e o lucro na restri√ß√£o de √°rea A = {{ A }} ha.</p>
        <img src="/{{ opt_plot_path }}" alt="Gr√°fico de Otimiza√ß√£o" style="max-width: 100%; height: auto;">
      </div>

      <!-- An√°lise com SymPy -->
      <div class="section">
        <h2>üßÆ An√°lise Simb√≥lica (SymPy)</h2>
        <details>
          <summary><strong>Clique para ver an√°lise detalhada</strong></summary>
          {% for culture, analysis in sympy_analysis.items() %}
          <div class="sympy-section">
            <h3>{{ culture }}</h3>
            <p><strong>Fun√ß√£o:</strong> {{ analysis['funcao'] }}</p>
            <p><strong>Primeira Derivada:</strong> {{ analysis['primeira_derivada'] }}</p>
            <p><strong>Segunda Derivada:</strong> {{ analysis['segunda_derivada'] }}</p>
            <p><strong>Pontos Cr√≠ticos:</strong> 
            {% for pc in analysis['pontos_criticos'] %}
              {{ "%.2f"|format(pc) }} ha
            {% endfor %}
            </p>
            {% for class_info in analysis['classificacao'] %}
            <p><strong>Classifica√ß√£o:</strong> {{ class_info['tipo'] }} em x = {{ "%.2f"|format(class_info['ponto']) }} ha</p>
            <p><strong>Lucro no Ponto Cr√≠tico:</strong> R$ {{ "%.2f"|format(class_info['lucro']) }}</p>
            {% endfor %}
          </div>
          {% endfor %}
        </details>
      </div>

      <!-- Tabela Comparativa Detalhada -->
      <div class="section">
        <h2>üí∞ Compara√ß√£o Detalhada</h2>
        <table>
          <thead>
            <tr>
              <th>Cultura</th>
              <th>Par√¢metro a</th>
              <th>Par√¢metro b</th>
              <th>Lucro em A={{ A }}ha</th>
              <th>% do Melhor</th>
            </tr>
          </thead>
          <tbody>
            {% for culture, profit in profits.items() %}
            <tr class="{% if culture == best %}highlight{% endif %}">
              <td><strong>{{ culture }}</strong></td>
              <td>{{ "%.2f"|format(params[culture]['a']) }}</td>
              <td>{{ "%.4f"|format(params[culture]['b']) }}</td>
              <td>R$ {{ "%.2f"|format(profit) }}</td>
              <td>{{ "%.1f"|format((profit / best_profit) * 100) }}%</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Hist√≥rico de Cen√°rios -->
      <div class="section">
        <h2>üìú Hist√≥rico de Simula√ß√µes</h2>
        {% if scenarios %}
        <table>
          <thead>
            <tr>
              <th>Data/Hora</th>
              <th>√Årea (ha)</th>
              <th>Theta</th>
              <th>Melhor Cultura</th>
            </tr>
          </thead>
          <tbody>
            {% for sc in scenarios[:10] %}
            <tr>
              <td>{{ sc.created_at }}</td>
              <td>{{ sc.area }}</td>
              <td>{{ sc.theta }}</td>
              <td>{{ sc.best }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <p>Nenhum cen√°rio anterior registrado.</p>
        {% endif %}
      </div>

      <!-- A√ß√µes -->
      <div class="actions">
        <a href="/" class="button">üîÑ Nova Simula√ß√£o</a>
        <a href="/persona" class="button">üë§ Ver Persona</a>
      </div>

      <hr>

      <!-- Explica√ß√£o Final -->
      <div class="explanation">
        <h3>üìö Fundamenta√ß√£o Matem√°tica</h3>
        <p>Este sistema utiliza <strong>c√°lculo diferencial</strong> para encontrar a aloca√ß√£o √≥tima de √°rea agr√≠cola.</p>
        
        <p><strong>Modelo Adotado:</strong></p>
        <p>L(x) = ax - bx¬≤</p>
        <p>Onde:</p>
        <ul>
          <li><strong>L(x)</strong> = Lucro esperado em fun√ß√£o da √°rea x (hectares)</li>
          <li><strong>a</strong> = Lucro por hectare (extra√≠do do artigo cient√≠fico)</li>
          <li><strong>b</strong> = Œ∏ √ó a (coeficiente de rendimentos decrescentes)</li>
        </ul>
        
        <p><strong>Deriva√ß√£o do Ponto √ìtimo:</strong></p>
        <ol>
          <li>Primeira derivada: L'(x) = a - 2bx</li>
          <li>Condi√ß√£o de m√°ximo: L'(x) = 0 ‚üπ x* = a/(2b)</li>
          <li>Segunda derivada: L''(x) = -2b &lt; 0 (confirma m√°ximo)</li>
        </ol>
        
        <p><strong>Interpreta√ß√£o:</strong></p>
        <p>A cultura <strong>{{ best }}</strong> maximiza o lucro para a √°rea de {{ A }} hectares porque:</p>
        <ul>
          <li>Seu lucro base por hectare (a = {{ "%.2f"|format(params[best]['a']) }}) √© elevado</li>
          <li>O efeito de rendimentos decrescentes (b = {{ "%.4f"|format(params[best]['b']) }}) √© moderado</li>
          <li>A combina√ß√£o resulta no maior L({{ A }}) = R$ {{ "%.2f"|format(best_profit) }}</li>
        </ul>
        
        <p><strong>Fonte dos Dados:</strong> Silva et al. (2024) - "Otimiza√ß√£o da produtividade agr√≠cola e altos lucros em pequenas propriedades"</p>
      </div>
    </div>

    <style>
      .section {
        margin: 30px 0;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
      }
      
      .highlight-box {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        border-radius: 10px;
        text-align: center;
        margin: 20px 0;
      }
      
      .best-culture {
        font-size: 2.5em;
        margin: 15px 0;
        font-weight: bold;
      }
      
      .best-profit {
        font-size: 1.5em;
      }
      
      .math-explanation {
        background: #e8f4f8;
        padding: 15px;
        border-left: 4px solid #667eea;
        margin-top: 20px;
      }
      
      .sympy-section {
        background: white;
        padding: 15px;
        margin: 10px 0;
        border-radius: 5px;
        border: 1px solid #ddd;
      }
      
      details {
        cursor: pointer;
      }
      
      summary {
        padding: 10px;
        background: #667eea;
        color: white;
        border-radius: 5px;
        user-select: none;
      }
      
      summary:hover {
        background: #5568d3;
      }
    </style>
  </body>
</html>